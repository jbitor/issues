#!/bin/bash
set -e

export GOPATH="$PWD/$(dirname ""$(which """"$0"""")"")"
export PATH="$PATH:$GOPATH/bin"

echo "Formatting..."
go fmt bitbucket.com/jeremybanks/go-distributed/bencoding
go fmt bitbucket.com/jeremybanks/go-distributed/distributed
go fmt bitbucket.com/jeremybanks/go-distributed/torrentmetainfo

echo
echo "Installing packages..."

go install bitbucket.com/jeremybanks/go-distributed/distributed

echo
echo "Testing..."
go test -run=. -bench=NONE bitbucket.com/jeremybanks/go-distributed/bencoding
go test -run=. -bench=NONE bitbucket.com/jeremybanks/go-distributed/torrentmetainfo

echo
echo "Running..."

distributed $*

echo
